"use strict";var domapp=angular.module("domapp",["ionic","ion-digit-keyboard","LocalStorageModule","hmTouchEvents","ionic-datepicker"]);domapp.constant("CONSTANTS",{BASE_PATH:"js/app/",BASE_URL:"#",API_URL:"http://domapp.web.dev/app_dev.php/api/v1/",API_URL_LOGIN_USER:"login",API_URL_IDENTIFY_PVI_UL:"pvis",API_URL_IDENTIFY_PVI_OL:"others/pvis",API_URL_UPDATE_PVI:"pvis",API_URL_DOWNLOAD_PVI:"pvis",INT_RT_LOGIN:"/",INT_RT_PVI_USER_LIST:"/pviUserList",INT_RT_PVI_OTHER_LIST:"/pviOtherList",INT_RT_PVI:"/task:",TO_DOWNLOAD:"TO_DOWNLOAD",IN_PREPARATION:"IN_PREPARATION",TO_SIGN:"TO_SIGN",TO_CLOSE:"TO_CLOSE",CLOSED:"CLOSED",WORK_DAY:"WORK_DAY",SATURDAY:"SATURDAY",SUNDAY_OFFDAY:"SUNDAY_OFFDAY",TYPE_CREATED:"CREATED",TYPE_IN_PREPARATION:"IN_PREPARATION",LS_KEY_USER:"USER",LS_KEY_PVI:"PVI",LS_KEY_PVI_OTHER:"PVI_OTHER",SIGNATURE_CLIENT:"client",SIGNATURE_TI:"ti",RESP_SUCCESS:"SUCCESS",RESP_ACCOUNT_NOT_ACTIVATED_CODE_VALID:"ACCOUNT_NOT_ACTIVATED_CODE_VALID",RESP_ACCOUNT_NOT_ACTIVATED_CODE_NOT_VALID:"ACCOUNT_NOT_ACTIVATED_CODE_NOT_VALID",RESP_UNKNOWN_SESA_OR_EMAIL:"UNKNOWN_SESA_OR_EMAIL",RESP_UNKNOWN_CODE:"UNKNOWN_CODE",NOT_ACTIVATED:"NOT_ACTIVATED",PENDING_ACTIVATION:"PENDING_ACTIVATION",ACTIVATED:"ACTIVATED"}),domapp.constant("TEXT",{AT_LOGIN:"Login",AT_CODE_ACTIVATION:"Code d'activation",AT_SESA:"SESA",AT_CLORE_PVI:"Clore PVI",AT_FIN_DE_SERVICE:"Fin de service",AT_VALIDER:"Valider",AT_SUPPRIMER_PVI:"Supprimer PVI",AT_PRET_A_SIGNER:"PVI prêt à signer",AT_ANOMALIES_TITRE:"Anomalies et compléments de présentation",AT_TEMPS_ATTENTE:"Temps d'attente",AT_CAUSE:"Cause",AT_TEMPS_PREPARATION:"Temps de préparation et rapport",AT_AVANT_TITRE:"Avant l'intervention",AT_ARRIVEE_SUR_SITE:"Arrivée sur site",AT_AVEC_CONSIGNATION:"Avec consignation",AT_OUI:"Oui",AT_NON:"Non",AT_TEMPS_CONSIGNATION:"Temps de consignation",AT_DETAIL_TITRE:"Détail intervention / travaux à prévoir",AT_INTERVENTION_REALISEE:"Intervention réalisée",AT_MAINTENANCE:"Maintenance réalisée selon devis",AT_SERVICE:"Mise en service réalisée selon devis",AT_REMPLACEMENT:"Remplacement/substitution réalisé selon devis",AT_DEPANNAGE:"Dépannage",AT_DETAIL_INTERVENTION:"Détail de l'intervention",AT_APPAREILS_MESURE:"Appareils de mesure<br />(indiquer le N° de série ou identifiant)",AT_OBSERVATIONS_TI:"Travaux à prévoir et observations particulières",AT_ECHEANCE_TRAVAUX:"Echéance des travaux",AT_MAIN_TITRE:"Main d'oeuvre",AT_TYPE_JOURNEE:"Type de journée",AT_JOUR_OUVRE:"Jour ouvré",AT_SAMEDI:"Samedi",AT_DIMANCHE:"Dimanche / jour férié",AT_TEMPS_PASSE:"Temps passé",AT_8H_18H:"Heures 8h-18h",AT_8_22H_6_8H:"Heures 18-22h / 6-8h",AT_22H_6H:"Heures 22h-6h",AT_HEURES_VOYAGE:"Heures de voyage",AT_DEPLACEMENT:"Déplacement",AT_KILOMETRAGE:"Kilométrage",AT_PEAGES:"Péages",AT_FRAIS:"Frais de vie",AT_MATERIEL_TITRE:"Matériel concerné",AT_REPORT_TECHNIQUE:"Remise d'un rapport technique détaillé",AT_MATERIEL:"Matériel",AT_POSTE:"Poste",AT_TABLEAU:"Tableau",AT_FONCTION:"Fonction",AT_GAMME:"Gamme / Type / N° de série",AT_AJOUTER_MATERIEL:"Ajouter un matériel",AT_TETE_TITRE:"En-tête du PVI",AT_NUMERO_DOSSIER:"Numéro de dossier",AT_CLIENT_ORDRE:"Client passeur d'ordre",AT_CLIENT_FINAL:"Client final",AT_INTERVENTION_NATURE:"Nature de l'intervention",AT_DEVIS:"Devis (forfait)",AT_ATTACHMENT:"Attachement",AT_HORS_GUARANTEE:"Dépannage hors garantie",AT_SOUS_GUARANTEE:"Dépannage sous garantie",AT_AUTRE:"Autre",AT_DEBUT_INTERVENTION:"Début intervention",AT_FIN_INTERVENTION:"Fin intervention<br />(sera renseigné à la signature)",AT_NB_INTERVENANTS:"Nb d'intervenants",AT_SIGNATURE_TITRE:"Signature du PVI",AT_CLIENT_SATISFACTION:"Note de satisfaction client",AT_OBSERVATION_CLIENT:"Observation du client",AT_CHARGES_TRAVAUX:"Chargé des travaux",AT_SIGNATURE_TI:"Signature du TI",AT_SIGNATURE_CLIENT:"Signature client",AT_AJOUTER_SIGNATURE:"Ajouter votre signature",AT_CLIENT_NOM:"Interlocuteur Client Nom",AT_CLIENT_ENTREPRISE:"Interlocuteur Client Entreprise",AT_CLIENT_TELEPHONE:"Interlocuteur Client Telephone",AT_CLIENT_EMAIL:"Interlocuteur Client Email",AT_CLIENT_EMAIL_ERREUR:"Le champs email n'est pas valide",AT_VALIDER_SIGNATURE:"Valider la signature",AT_ANNULER:"Annuler",AT_EFFACER:"Effacer",AT_OK:"OK",AT_TELECHARGEMENT_VOS_PVIS:"Téléchargement de vos pvis...",AT_PAS_CHEF_MISSION:"Vous n'êtes pas le chef de mission",AT_CREER_PVI:"Créer un PVI de dépannage",HEADER_USER_PVI:"Mes PVI en cours",HEADER_OTHER_PVI:"Autres PVI",HEADER_PREPARE_PVI:"Préparer un PVI",HEADER_ADD_SIGNATURE_PVI:"Ajouter votre signature",UA_ACCOUNT_NOT_ACTIVATED_CODE_VALID_TITLE:"Code d'activation",UA_ACCOUNT_NOT_ACTIVATED_CODE_VALID_TEXT:"Votre code d'activation vous a été envoyé par mail. Vous devez le saisir ici pour activer votre compte (il ne vous sera plus demandé ultérieurement)",UA_ACCOUNT_NOT_ACTIVATED_CODE_NOT_VALID_TITLE:"Code d'activation",UA_ACCOUNT_NOT_ACTIVATED_CODE_NOT_VALID_TEXT:"Votre code d'activation précédent a expiré. Un nouveau code vous a été envoyé par mail. Vous devez le saisir ici pour activer votre compte (il ne vous sera plus demandé ultérieurement)",UA_UNKNOWN_SESA_TITLE:"Erreur d'authentification",UA_UNKNOWN_SESA_TEXT:"Code SESA inconnu, veuillez le saisir à nouveau",UA_UNKNOWN_CODE_TITLE:"Erreur d'activation",UA_UNKNOWN_CODE_TEXT:"Code d'activation inconnu",UA_NO_CONNECTION_TITLE:"Pas de connexion",UA_NO_CONNECTION_TEXT:"Il n'y a pas de connexion réseau, veuillez réessayer avec une connexion",UA_CANNOT_CLOSE_PVI_TITLE:"Vous ne pouvez pas clore le PVI",UA_CANNOT_CLOSE_PVI_TEXT:"Vous devez être connecté au réseau pour clore le PVI, veuillez réessayer avec une connexion",UA_CLOSE_TAB_DATA_DELETION_TITLE:"Êtes-vous sûr de fermer cet onglet ?",UA_CLOSE_TAB_DATA_DELETION_TEXT:"La fermeture de cet onglet va supprimer les entrées associées",UA_REMOVE_ITEM_DATA_DELETION_TITLE:"Êtes-vous sûr de supprimer cet élément ?",UA_REMOVE_ITEM_DATA_DELETION_TEXT:"La suppression de cet élément va supprimer les données associées",UA_REMOVE_PVI_DATA_DELETION_TITLE:"Êtes-vous sûr de supprimer ce PVI ?",UA_REMOVE_PVI_DATA_DELETION_TEXT:"La suppression de ce PVI va supprimer les données associées",UA_NO_SIGNATURE_TITLE:"Signature manquante",UA_NO_SIGNATURE_TEXT:"Il n'y a pas de signature. Veuillez réessayer",UA_CANNOT_UPDATE_CREATED_PVI_TITLE:"Pas de connection",UA_CANNOT_UPDATE_CREATED_PVI_TEXT:"Il n'y a pas de signature. Veuillez réessayer"}),domapp.config(["$stateProvider","$urlRouterProvider","$httpProvider","localStorageServiceProvider","ionicDatePickerProvider","CONSTANTS",function(e,t,i,n,a,r){e.state("login",{url:"/",views:{login:{templateUrl:r.BASE_PATH+"login/directives/login.html",controller:"loginController"}}}).state("pviUserList",{url:"/pviUserList",views:{pviUserList:{templateUrl:r.BASE_PATH+"pviList/directives/pviUserList.html",controller:"pviUserListController"}}}).state("pviOtherList",{url:"/pviOtherList",views:{pviOtherList:{templateUrl:r.BASE_PATH+"pviList/directives/pviOtherList.html",controller:"pviOtherListController"}}}).state("pvi",{url:"/task:pviId",views:{pvi:{templateUrl:r.BASE_PATH+"task/directives/task.html",controller:"pviController"}}}),t.otherwise("/"),i.interceptors.push("httpInterceptor"),n.setPrefix("domapp").setStorageType("localStorage").setNotify(!0,!0);var o={closeLabel:"Fermer",mondayFirst:!1,weeksList:["S","M","T","W","T","F","S"],monthsList:["Jan","Feb","March","April","May","June","July","Aug","Sept","Oct","Nov","Dec"],templateType:"popup",showTodayButton:!1,dateFormat:"dd MM yyyy",closeOnSelect:!0};a.configDatePicker(o)}]),domapp.run(["$rootScope","$location","CONSTANTS","persistenceService","$ionicPlatform",function(e,t,i,n,a){a.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()}),n.checkExistsLocalStorage(i.LS_KEY_USER)&&n.restoreLocalStorage(i.LS_KEY_USER),n.checkExistsLocalStorage(i.LS_KEY_PVI)&&n.restoreLocalStorage(i.LS_KEY_PVI),n.checkExistsLocalStorage(i.LS_KEY_PVI_OTHER)&&n.restoreLocalStorage(i.LS_KEY_PVI_OTHER),e.keyboardVisible=!1,e.keyboardSettings={resizeContent:!0,action:function(t){var i=String(t);e.$$childHead.$$childHead.$$childTail.$$childHead.pvi[e.editingInput]=e.$$childHead.$$childHead.$$childTail.$$childHead.pvi[e.editingInput]+i},leftButton:{html:"<p>H</p>",action:function(){e.$$childHead.$$childHead.$$childTail.$$childHead.pvi[e.editingInput]=e.$$childHead.$$childHead.$$childTail.$$childHead.pvi[e.editingInput]+"h"}},rightButton:{html:'<i class="icon ion-backspace"></i>',action:function(){e.$$childHead.$$childHead.$$childTail.$$childHead.pvi[e.editingInput]=e.$$childHead.$$childHead.$$childTail.$$childHead.pvi[e.editingInput].slice(0,-1)}},okButton:{html:'<i class="icon ion-checkmark-circled"></i>',action:function(){e.keyboardVisible=!1,e.editingInput=null}}},e.hideKeyPad=function(t){e.keyboardVisible&&"input"!=t.target.localName&&"i"!=t.target.localName&&(e.keyboardVisible=!1,e.editingInput=null)}}]),domapp.directive("header",["CONSTANTS","TEXT","$location","blockModel",function(e,t,i,n){return{restrict:"C",replace:!1,priority:0,link:function(a,r,o,_){a.pviHeaderText=function(){var a="";switch(i.$$path){case e.INT_RT_PVI_USER_LIST:a=t.HEADER_USER_PVI;break;case e.INT_RT_PVI_OTHER_LIST:a=t.HEADER_OTHER_PVI;break;default:a=n.block.signature_pad?t.HEADER_ADD_SIGNATURE_PVI:t.HEADER_PREPARE_PVI}return a},a.showPviHeader=function(){return i.$$path!=e.INT_RT_LOGIN}}}}]),angular.module("ion-digit-keyboard.directive",[]).directive("ionDigitKeyboard",["CONSTANTS","$timeout","$ionicScrollDelegate",function(e,t,i){var n=150;return{restrict:"EA",templateUrl:e.BASE_PATH+"common/directives/keyboard.tpl.html",replace:!0,scope:{settings:"=settings",ngShow:"=",ngHide:"="},link:function(e,a,r){function o(){1==u&&(d.style.bottom="0px",d.style.height=c)}function _(){t(function(){if(1==u){var e=a[0].offsetHeight;c=d.style.height,d.style.height="auto",d.style.bottom=e+1+"px"}},n+10)}function l(){e.ngShow===!0?_():e.ngShow===!1&&o(),i.resize()}function s(){e.ngHide===!0?o():e.ngHide===!1&&_(),i.resize()}"undefined"==typeof e.settings&&(e.settings={});var d,c,u=!0,v="ion-content",p={},T={};if(e.leftStyle="",e.rightStyle="",e.leftFontSize="",e.rightFontSize="",e.showLetters="undefined"==typeof e.settings.showLetters?!1:e.settings.showLetters,e.roundButtons="undefined"==typeof e.settings.roundButtons?!1:e.settings.roundButtons,e.numberAction=e.settings.action||function(){},e.width=e.settings.width||"100%",e.align=e.settings.align||"center",e.animation=e.settings.animation||"slide-up",e.theme=e.settings.theme||"stable","undefined"!=typeof e.settings.leftButton&&"object"==typeof e.settings.leftButton.style&&("undefined"!=typeof e.settings.leftButton.style.color&&(e.leftStyle+="color: "+e.settings.leftButton.style.color+";"),"undefined"!=typeof e.settings.leftButton.style.bgColor&&(p["default"]=e.settings.leftButton.style.bgColor,e.leftStyle+="background-color: "+p["default"]+";"),"undefined"!=typeof e.settings.leftButton.style.activeBgColor&&(p.active=e.settings.leftButton.style.activeBgColor),"undefined"!=typeof e.settings.leftButton.style.borderColor&&(e.leftStyle+="border-color: "+e.settings.leftButton.style.borderColor+" !important;"),"undefined"!=typeof e.settings.leftButton.style.fontSize&&(e.leftFontSize="font-size: "+e.settings.leftButton.style.fontSize+" !important;")),"undefined"!=typeof e.settings.rightButton&&"object"==typeof e.settings.rightButton.style&&("undefined"!=typeof e.settings.rightButton.style.color&&(e.rightStyle+="color: "+e.settings.rightButton.style.color+";"),"undefined"!=typeof e.settings.rightButton.style.bgColor&&(T["default"]=e.settings.rightButton.style.bgColor,e.rightStyle+="background-color: "+T["default"]+";"),"undefined"!=typeof e.settings.rightButton.style.activeBgColor&&(T.active=e.settings.rightButton.style.activeBgColor),"undefined"!=typeof e.settings.rightButton.style.borderColor&&(e.rightStyle+="border-color: "+e.settings.rightButton.style.borderColor+" !important;"),"undefined"!=typeof e.settings.rightButton.style.fontSize&&(e.rightFontSize="font-size: "+e.settings.rightButton.style.fontSize+" !important;")),e.showLeftAction=!1,"undefined"!=typeof e.settings.leftButton&&(e.leftHtml=e.settings.leftButton.html,e.showLeftAction=!0,e.leftAction=function(t){if(p.active){var i=t.target;"I"==i.tagName?i=i.parentNode.parentNode:i.className.indexOf("digit-keyboard-key-action")>-1&&(i=i.parentNode),"undefined"==typeof p["default"]&&(p["default"]=i.style.backgroundColor),i.style.backgroundColor=p.active,setTimeout(function(){i.style.backgroundColor=p["default"]},100)}e.settings.leftButton.action()}),e.showRightAction=!1,"undefined"!=typeof e.settings.rightButton&&(e.rightHtml=e.settings.rightButton.html,e.showRightAction=!0,e.rightAction=function(t){if(T.active){var i=t.target;"I"==i.tagName?i=i.parentNode.parentNode:i.className.indexOf("digit-keyboard-key-action")>-1&&(i=i.parentNode),"undefined"==typeof T["default"]&&(T["default"]=i.style.backgroundColor),i.style.backgroundColor=T.active,setTimeout(function(){i.style.backgroundColor=T["default"]},100)}e.settings.rightButton.action()}),e.showOkAction=!1,"undefined"!=typeof e.settings.okButton&&(e.okHtml=e.settings.okButton.html,e.showOkAction=!0,e.okAction=function(t){if(T.active){var i=t.target;"I"==i.tagName?i=i.parentNode.parentNode:i.className.indexOf("digit-keyboard-key-action")>-1&&(i=i.parentNode),"undefined"==typeof T["default"]&&(T["default"]=i.style.backgroundColor),i.style.backgroundColor=T.active,setTimeout(function(){i.style.backgroundColor=T["default"]},100)}e.settings.okButton.action()}),"object"==typeof e.settings.resizeContent||"boolean"==typeof e.settings.resizeContent)if("object"==typeof e.settings.resizeContent)var u="undefined"==typeof e.settings.resizeContent.enable?!0:e.settings.resizeContent.enable,v="undefined"==typeof e.settings.resizeContent.element?"ion-content":e.settings.resizeContent.element;else"boolean"==typeof e.settings.resizeContent&&(u=e.settings.resizeContent);d=a[0].parentElement.querySelectorAll(v)[0],e.$watch("ngShow",l),e.$watch("ngHide",s)}}}]),domapp.directive("tabs",["CONSTANTS","$location","routingService","blockModel",function(e,t,i,n){return{restrict:"C",replace:!1,priority:0,link:function(a,r,o,_){a.showTabs=function(){return t.$$path!=e.INT_RT_LOGIN&&!n.block.signature_pad},a.myPviNavTabIsActive=function(){return t.$$path==e.INT_RT_PVI_USER_LIST},a.otherPviNavTabIsActive=function(){return t.$$path==e.INT_RT_PVI_OTHER_LIST},a.loadUserList=function(t){i.navigate(e.INT_RT_PVI_USER_LIST)},a.loadOtherList=function(t){i.navigate(e.INT_RT_PVI_OTHER_LIST)}}}}]),domapp.service("blockModel",[function(){this.block={avant_block:!0,tete_block:!1,main_block:!1,anomalies_block:!1,materiel_block:!1,detail_block:!1,signature_pad:!1},this.minorBlock={work_day:!1,saturday:!1,sunday_offday:!1}}]),domapp.service("validationModel",[function(){this.validationAvant={avant_block:{error:!1,complete:!1},arrival_date:{error:!1},arrival_time:{error:!1},with_consignment:{error:!1},consignment_duration:{error:!1}},this.validationTete={tete_block:{error:!1,complete:!1},file_number:{error:!1},order_customer_name:{error:!1},final_customer_name:{error:!1},interventions_nature:{error:!1},is_intervention_nature_quotation:{error:!1},is_intervention_nature_attachment:{error:!1},is_intervention_nature_no_guarantee:{error:!1},is_intervention_nature_with_guarantee:{error:!1},is_intervention_nature_other:{error:!1},interventions_nature_other_text:{error:!1},actual_start_date:{error:!1},actual_start_time:{error:!1},ti_number:{error:!1}},this.validationMain={main_block:{error:!1,complete:!1},day_selection:{error:!1},work_day_mileage:{error:!1},work_day_trip_duration:{error:!1},work_day_tolls:{error:!1},work_day_expenses:{error:!1},work_day_work_duration_day:{error:!1},work_day_work_duration_evening_morning:{error:!1},work_day_work_duration_night:{error:!1},saturday_mileage:{error:!1},saturday_trip_duration:{error:!1},saturday_tolls:{error:!1},saturday_expenses:{error:!1},saturday_work_duration_day:{error:!1},saturday_work_duration_evening_morning:{error:!1},saturday_work_duration_night:{error:!1},sunday_offday_mileage:{error:!1},sunday_offday_trip_duration:{error:!1},sunday_offday_tolls:{error:!1},sunday_offday_expenses:{error:!1},sunday_offday_work_duration_day:{error:!1},sunday_offday_work_duration_evening_morning:{error:!1},sunday_offday_work_duration_night:{error:!1}},this.validationAnomalies={anomalies_block:{error:!1,complete:!1},waiting_duration:{error:!1},waiting_duration_cause:{error:!1},preparation_duration:{error:!1}},this.validationMateriel={materiel_block:{error:!1,complete:!1},has_technical_report:{error:!1},elec_substation:{},elec_board:{},"function":{},material_info:{}},this.validationDetail={detail_block:{error:!1,complete:!1},interventions_realised:{error:!1},is_intervention_realised_maintenance:{error:!1},is_intervention_realised_installation:{error:!1},is_intervention_realised_replacement:{error:!1},is_intervention_realised_assistance:{error:!1},intervention_detail:{error:!1},observation_ti:{error:!1},observation_client:{error:!1},device_measure:{error:!1},deadline:{error:!1}},this.validationSignature={signature_block:{error:!1,complete:!1},work_responsible_name:{error:!1},client_signature_data:{error:!1},ti_signature_data:{error:!1},client_satisfaction_level:{error:!1},contact_name:{error:!1},contact_phone:{error:!1},contact_email:{error:!1,error_format:!1},contact_company_name:{error:!1}},this.validationClose={close_block:{error:!1,complete:!1},actual_end_date:{error:!1},actual_end_time:{error:!1}}}]),angular.module("ion-digit-keyboard",["ionic","ion-digit-keyboard.directive"]),domapp.factory("alertService",[function(){return{displayAlert:function(e,t,i,n,a){swal({title:e,text:t,animation:!1,showCancelButton:i,confirmButtonColor:"#a5d6a7",confirmButtonText:"Oui",cancelButtonText:"Non",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?"undefined"!=typeof n&&n():"undefined"!=typeof a&&a()})}}}]),domapp.factory("communicationService",["$http","CONSTANTS","TEXT","connectionService","userLocalService","alertService",function(e,t,i,n,a,r){return{request:function(t,o,_,l,s){if(n.testConnection()){var d="",c=a.getUser().APIKey;null!=c&&""!=c&&(d="?token="+c),e({method:_,url:window.config.apiUrl+o+d,data:t}).then(function(e){"undefined"!=typeof s&&l(e.data)},function(e){"undefined"!=typeof s&&s(e.status)})}else r.displayAlert(i.UA_NO_CONNECTION_TITLE,i.UA_NO_CONNECTION_TEXT,!1)}}}]),domapp.factory("connectionService",[function(){return{testConnection:function(){try{if("undefined"!=typeof navigator.onLine)return navigator.onLine}catch(e){}}}}]),domapp.factory("helperService",[function(){return{getCurrentDate:function(){var e=new Date,t=e.getDate(),i=e.getMonth()+1,n=e.getFullYear();return 10>i&&(i="0"+i),10>t&&(t="0"+t),t+"/"+i+"/"+n},getCurrentTime:function(e){var t=new Date,i=t.getHours(),n=t.getMinutes();return e&&(n=57>=n?String(n%5>=2.5?5*parseInt(n/5)+5:5*parseInt(n/5)):"00"),1==i.toString().length&&(i="0"+i),1==n.toString().length&&(n="0"+n),i+":"+n},checkEmail:function(e){var t=/^[a-zA-Z0-9!#$%&'*+/=?^_`{~-]+((\.[a-zA-Z0-9!#$%&'*+/=?^_`{~-]+)?)+@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/;return t.test(e)},convertToDecimal:function(e){if("undefined"!=typeof e&&null!=e){var t=0,i=0;if(e.indexOf("h")>-1){var n=e.split("h");t=n[0].toString().substring(0,2),i=n[1].toString().substring(0,2),""==t&&(t=0),""==i&&(i=0)}else i=e.toString().substring(0,2);i=parseInt(i),t=parseInt(t),i=i>=0&&7.5>=i?0:i>7.5&&22.5>=i?25:i>22.5&&37.5>=i?50:i>37.5&&52.5>=i?75:0,e=t+"."+i}return e},convertToHoursMinutes:function(e){if("undefined"!=typeof e&&null!==e&&""!==e){var t=0,i=0;if(e=e.toString(),e.indexOf(".")>-1){var n=e.split(".");t=n[0],i=n[1],""==t&&(t=0),""==i&&(i=0)}i=parseInt(i),t=parseInt(t),i=i>=0&&12>=i?"00":i>12&&37>=i?"15":i>37&&62>=i?"30":i>62&&87>=i?"45":"00",e=t+"h"+i}return e}}}]),domapp.service("httpInterceptor",["CONSTANTS","$q","routingService",function(e,t,i){var n=this;n.responseError=function(n){switch(n.status){case 400:break;case 401:i.navigate(e.INT_RT_LOGIN);break;case 403:i.navigate(e.INT_RT_LOGIN);break;case 404:break;case 500:}return t.reject(n)}}]),domapp.factory("persistenceService",["CONSTANTS","localStorageService","userModel","pviModel","pviOtherModel",function(e,t,i,n,a){return{setLocalStorage:function(r){switch(r){case e.LS_KEY_USER:t.set(e.LS_KEY_USER,angular.toJson(i.user));break;case e.LS_KEY_PVI:t.set(e.LS_KEY_PVI,angular.toJson(n.pvi));break;case e.LS_KEY_PVI_OTHER:t.set(e.LS_KEY_PVI_OTHER,angular.toJson(a.pvi))}},restoreLocalStorage:function(r){switch(r){case e.LS_KEY_USER:var o=t.get(e.LS_KEY_USER);i.user=JSON.parse(o);break;case e.LS_KEY_PVI:var _=t.get(e.LS_KEY_PVI);n.pvi=JSON.parse(_);break;case e.LS_KEY_PVI_OTHER:var l=t.get(e.LS_KEY_PVI_OTHER);a.pvi=JSON.parse(l)}},checkExistsLocalStorage:function(e){var i=t.keys();return i.indexOf(e)>-1}}}]),domapp.factory("routingService",["CONSTANTS",function(e){return{navigate:function(t){window.location.href=e.BASE_URL+t}}}]),domapp.controller("loginController",["$scope","CONSTANTS","TEXT","userModel","persistenceService","routingService",function(e,t,i,n,a,r){e.constants=t,e.text=i,e.user=n.user,null!=e.user.sesa&&""!=e.user.sesa&&e.user.activationState==t.ACTIVATED&&r.navigate(t.INT_RT_PVI_USER_LIST)}]),domapp.directive("login",["CONSTANTS","loginCommunicationService",function(e,t){return{restrict:"C",replace:!1,priority:0,link:function(e,i,n,a){e.loginButtonTap=function(i){t.loginUser(e.user)}}}}]),domapp.factory("loginCommunicationService",["CONSTANTS","TEXT","routingService","communicationService","userLocalService","persistenceService","alertService",function(e,t,i,n,a,r,o){return{loginUser:function(_){var l={sesa:_.sesa,code:_.activationCode};n.request(l,e.API_URL_LOGIN_USER,"POST",function(n){switch(n.respCode){case e.RESP_SUCCESS:a.setUserAPIKey(n.apiKey),a.activateUser(),r.setLocalStorage(e.LS_KEY_USER),i.navigate(e.INT_RT_PVI_USER_LIST);break;case e.RESP_ACCOUNT_NOT_ACTIVATED_CODE_VALID:_.activationState=e.PENDING_ACTIVATION,r.setLocalStorage(e.LS_KEY_USER),o.displayAlert(t.UA_ACCOUNT_NOT_ACTIVATED_CODE_VALID_TITLE,t.UA_ACCOUNT_NOT_ACTIVATED_CODE_VALID_TEXT,!1);break;case e.RESP_ACCOUNT_NOT_ACTIVATED_CODE_NOT_VALID:_.activationState=e.PENDING_ACTIVATION,r.setLocalStorage(e.LS_KEY_USER),o.displayAlert(t.UA_ACCOUNT_NOT_ACTIVATED_CODE_NOT_VALID_TITLE,t.UA_ACCOUNT_NOT_ACTIVATED_CODE_NOT_VALID_TEXT,!1);break;case e.RESP_UNKNOWN_SESA_OR_EMAIL:o.displayAlert(t.UA_UNKNOWN_SESA_TITLE,t.UA_UNKNOWN_SESA_TEXT,!1);break;case e.RESP_UNKNOWN_CODE:o.displayAlert(t.UA_UNKNOWN_CODE_TITLE,t.UA_UNKNOWN_CODE_TEXT,!1)}},function(e){})}}}]),domapp.controller("pviController",["CONSTANTS","TEXT","$scope","$stateParams","pviModel","pviLocalService","validationModel","validationService","completionService","blockModel","persistenceService",function(e,t,i,n,a,r,o,_,l,s,d){i.text=t,i.constants=e,i.currentPviId=parseInt(n.pviId.substring(1)),i.pvi=a.pvi,i.validationAvant=o.validationAvant,i.validationTete=o.validationTete,i.validationMain=o.validationMain,i.validationAnomalies=o.validationAnomalies,i.validationMateriel=o.validationMateriel,i.validationDetail=o.validationDetail,i.validationSignature=o.validationSignature,i.validationClose=o.validationClose,i.blockModel=s,i.currentSignatureType=null,i.signaturePad=null,i.$watch("pvi",function(){d.setLocalStorage(e.LS_KEY_PVI),l.initializeCompletion(),l.checkBlockCompletion(r.getPviById(i.currentPviId))},!0),i.$watch("blockModel",function(){l.initializeCompletion(),l.checkBlockCompletion(r.getPviById(i.currentPviId))},!0),_.initializeValidation(),i.checkId=function(e){return e.id==i.currentPviId}}]),domapp.directive("pviClose",["CONSTANTS","TEXT","validationService","persistenceService","pviCommunicationService","pviLocalService","alertService","$timeout","routingService",function(e,t,i,n,a,r,o,_,l){return{templateUrl:e.BASE_PATH+"task/directives/pviClose.html",restrict:"C",replace:!1,priority:0,link:function(s,d,c,u){$(".clockpicker_actual_end_time").clockpicker({donetext:"Done",afterDone:function(e){var t=String(e),i=t.split(" "),n=i[4].split(":");$("#actual_end_time").attr("value",n[0]+":"+n[1]).trigger("input"),s.updateTime("actual_end_time",n[0],n[1]),s.$apply()}}),s.validateClosePvi=function(d){i.validateClose(s.pvi)&&a.updatePvi(s.pvi,function(){s.pvi.state_code=e.CLOSED,n.setLocalStorage(e.LS_KEY_PVI),_(function(){r.removeUserPviById(s.pvi.id),l.navigate(e.INT_RT_PVI_USER_LIST)},500)},function(){o.displayAlert(t.UA_CANNOT_CLOSE_PVI_TITLE,t.UA_CANNOT_CLOSE_PVI_TEXT,!1)})}}}}]),domapp.directive("pvi",["CONSTANTS","$rootScope","pviModel","routingService",function(e,t,i,n){return{restrict:"C",replace:!1,priority:0,link:function(t,i,a,r){t.loadUserList=function(t){n.navigate(e.INT_RT_PVI_USER_LIST)}}}}]),domapp.directive("pviPrepareAnomalies",["CONSTANTS","$anchorScroll","$location","$rootScope","validationService","pviCommunicationService","persistenceService","blockModel",function(e,t,i,n,a,r,o,_){return{templateUrl:e.BASE_PATH+"task/directives/pviPrepareAnomalies.html",restrict:"C",replace:!0,priority:0,scope:!1,link:function(e,t,i,n){}}}]),domapp.directive("pviPrepareAvant",["CONSTANTS",function(e){return{templateUrl:e.BASE_PATH+"task/directives/pviPrepareAvant.html",restrict:"C",replace:!0,priority:0,scope:!1,link:function(e,t,i,n){$(".clockpicker_arrival_time").clockpicker({donetext:"Done",afterDone:function(t){var i=String(t),n=i.split(" "),a=n[4].split(":");$("#arrival_time").attr("value",a[0]+":"+a[1]).trigger("input"),e.updateTime("arrival_time",a[0],a[1]),e.$apply()}})}}}]),domapp.directive("pviPrepareDetail",["CONSTANTS","$anchorScroll","$location","$rootScope","validationService","pviCommunicationService","persistenceService","blockModel",function(e,t,i,n,a,r,o,_){return{templateUrl:e.BASE_PATH+"task/directives/pviPrepareDetail.html",restrict:"C",replace:!0,priority:0,scope:!1,link:function(e,t,i,n){}}}]),domapp.directive("pviPrepare",["CONSTANTS","TEXT","$timeout","$anchorScroll","$location","$rootScope","validationService","pviLocalService","routingService","pviCommunicationService","persistenceService","blockModel","ionicDatePicker","$ionicScrollDelegate","helperService","alertService",function(e,t,i,n,a,r,o,_,l,s,d,c,u,v,p,T){return{templateUrl:e.BASE_PATH+"task/directives/pviPrepare.html",restrict:"C",replace:!1,priority:0,link:function(n,f,g,m){n.updateTime=function(e,t,i){1==i.length&&(i="0"+i),1==t.length&&(t="0"+t),n.pvi[e]=t+":"+i,n.pvi.blank&&"actual_start_time"==e&&(n.pvi.mission_start_time=t+":"+i)},n.updateDate=function(e,t){var i=null,a=null;i=1==String(t.getMonth()+1).length?"0"+String(t.getMonth()+1):String(t.getMonth()+1),a=1==String(t.getDate()).length?"0"+String(t.getDate()):String(t.getDate()),n.pvi[e]=a+"/"+i+"/"+t.getFullYear(),n.pvi.blank&&"actual_start_date"==e&&(n.pvi.mission_start_date=a+"/"+i+"/"+t.getFullYear())},n.isBlockDisplayed=function(e){for(var t in c.block)if(t==e)return c.block[t]},n.toggleBlock=function(e){c.block[e]=!c.block[e];var t=a.hash(e);v.$getByHandle("mainScroll").anchorScroll("#"+t);for(var i in c.block)i!=e&&(c.block[i]=!1)},n.validatePreparePvi=function(t){o.initializeValidation();var a=o.validateAvant(n.pvi),r=o.validateTete(n.pvi),_=o.validateMain(n.pvi),c=o.validateAnomalies(n.pvi),u=o.validateMateriel(n.pvi),v=o.validateDetail(n.pvi);a&&r&&_&&c&&u&&v&&(s.updatePvi(n.pvi,function(t){1==n.pvi.blank&&(n.pvi.id=t.id,n.pvi.blank=!1,n.pvi.state_code=e.TO_SIGN,d.setLocalStorage(e.LS_KEY_PVI),l.navigate(e.INT_RT_PVI+n.pvi.id))}),i(function(){n.pvi.state_code=e.TO_SIGN,d.setLocalStorage(e.LS_KEY_PVI)},500))},n.editTime=function(e,t){var i=n.pvi[e].split(":"),a=i[0],r=i[1];switch(t){case"add":"55"==r?(r="00",a="23"==a?"00":parseInt(a)+1):r=parseInt(r)+5;break;case"deduct":"00"==r?(r="55",a="00"==a?"23":parseInt(a)-1):r=parseInt(r)-5}r=String(r),a=String(a),n.updateTime(e,a,r)},n.showKeypad=function(e){var t=a.hash(e+"_label");v.$getByHandle("mainScroll").anchorScroll("#"+t),null!==n.pvi[e]&&"undefined"!=typeof n.pvi[e]||(n.pvi[e]=""),r.keyboardVisible=!0,r.editingInput=e},n.editDay=function(e,t){var i=n.pvi[e].split("/"),a=new Date(i[2]+"/"+i[1]+"/"+i[0]);"add"==t?a.setDate(a.getDate()+1):"deduct"==t&&a.setDate(a.getDate()-1),n.updateDate(e,a)},n.openDatePicker=function(e){var t=null;t=""!=n.pvi[e]&&null!=n.pvi[e]?n.pvi[e].split("/"):p.getCurrentDate().split("/");var i={callback:function(t){var i=new Date(t);n.updateDate(e,i)},inputDate:new Date(t[2]+"/"+t[1]+"/"+t[0])};u.openDatePicker(i)},n.removePvi=function(i){T.displayAlert(t.UA_REMOVE_PVI_DATA_DELETION_TITLE,t.UA_REMOVE_PVI_DATA_DELETION_TEXT,!0,function(){_.removeUserPviById(n.pvi.id),l.navigate(e.INT_RT_PVI_USER_LIST)})}}}}]),domapp.directive("pviPrepareMain",["CONSTANTS","TEXT","alertService",function(e,t,i){return{templateUrl:e.BASE_PATH+"task/directives/pviPrepareMain.html",restrict:"C",replace:!0,priority:0,scope:!1,link:function(e,n,a,r){e.toggleMinorBlock=function(n){e.pvi[n]&&(""!=e.pvi[n+"_mileage"]&&null!=e.pvi[n+"_mileage"]||""!=e.pvi[n+"_trip_duration"]&&null!=e.pvi[n+"_trip_duration"]||""!=e.pvi[n+"_tolls"]&&null!=e.pvi[n+"_tolls"]||""!=e.pvi[n+"_expenses"]&&null!=e.pvi[n+"_expenses"]||""!=e.pvi[n+"_work_duration_day"]&&null!=e.pvi[n+"_work_duration_day"]||""!=e.pvi[n+"_work_duration_evening_morning"]&&null!=e.pvi[n+"_work_duration_evening_morning"]||""!=e.pvi[n+"_work_duration_night"]&&null!=e.pvi[n+"_work_duration_night"])&&i.displayAlert(t.UA_CLOSE_TAB_DATA_DELETION_TITLE,t.UA_CLOSE_TAB_DATA_DELETION_TEXT,!0,function(){e.pvi[n+"_mileage"]="",e.pvi[n+"_trip_duration"]="",e.pvi[n+"_tolls"]="",e.pvi[n+"_expenses"]="",e.pvi[n+"_work_duration_day"]="",e.pvi[n+"_work_duration_evening_morning"]="",e.pvi[n+"_work_duration_night"]=""},function(){e.pvi[n]=!0,e.$apply()})}}}}]),domapp.directive("pviPrepareMateriel",["CONSTANTS","TEXT","alertService",function(e,t,i){return{templateUrl:e.BASE_PATH+"task/directives/pviPrepareMateriel.html",restrict:"C",replace:!0,priority:0,scope:!1,link:function(e,n,a,r){e.addMaterial=function(){var t={line:e.pvi.materials.length+1,elec_substation:"",elec_board:"","function":"",material_info:""};e.validationMateriel.elec_substation["line_"+t.line]={error:!1},e.validationMateriel.elec_board["line_"+t.line]={error:!1},e.validationMateriel["function"]["line_"+t.line]={error:!1},e.validationMateriel.material_info["line_"+t.line]={error:!1},e.pvi.materials.push(t)},e.removeMaterial=function(n){for(var a=function(){for(var t=!1,i=e.pvi.materials.length-1;i>=0;i--)e.pvi.materials[i].line==n&&(e.pvi.materials.splice(i,1),t=!0);for(var i=0,a=e.pvi.materials.length;a>i;i++)if(t&&e.pvi.materials[i].line>n&&"undefined"!=typeof e.pvi.materials[i]&&e.pvi.materials[i].line>1){var r=parseInt(e.pvi.materials[i].line)-1;e.validationMateriel.elec_substation["line_"+r]=e.validationMateriel.elec_substation["line_"+e.pvi.materials[i].line],e.validationMateriel.elec_board["line_"+r]=e.validationMateriel.elec_board["line_"+e.pvi.materials[i].line],e.validationMateriel["function"]["line_"+r]=e.validationMateriel["function"]["line_"+e.pvi.materials[i].line],e.validationMateriel.material_info["line_"+r]=e.validationMateriel.material_info["line_"+e.pvi.materials[i].line],e.pvi.materials[i].line=r}},r=0,o=e.pvi.materials.length;o>r;r++)e.pvi.materials[r].line==n&&(""!=e.pvi.materials[r].elec_substation&&null!=e.pvi.materials[r].elec_substation||""!=e.pvi.materials[r].elec_board&&null!=e.pvi.materials[r].elec_board||""!=e.pvi.materials[r]["function"]&&null!=e.pvi.materials[r]["function"]||""!=e.pvi.materials[r].material_info&&null!=e.pvi.materials[r].material_info?i.displayAlert(t.UA_REMOVE_ITEM_DATA_DELETION_TITLE,t.UA_REMOVE_ITEM_DATA_DELETION_TEXT,!0,function(){a(),e.$apply()}):a())}}}}]),domapp.directive("pviPrepareTete",["CONSTANTS",function(e){return{templateUrl:e.BASE_PATH+"task/directives/pviPrepareTete.html",restrict:"C",
replace:!0,priority:0,scope:!1,link:function(e,t,i,n){$(".clockpicker_actual_start_time").clockpicker({donetext:"Done",afterDone:function(t){var i=String(t),n=i.split(" "),a=n[4].split(":");$("#actual_start_time").attr("value",a[0]+":"+a[1]).trigger("input"),e.updateTime("actual_start_time",a[0],a[1]),e.$apply()}})}}}]),domapp.directive("pviSignature",["CONSTANTS","$timeout","$location","validationService","pviCommunicationService","persistenceService","$ionicScrollDelegate","helperService","routingService",function(e,t,i,n,a,r,o,_,l){return{templateUrl:e.BASE_PATH+"task/directives/pviSignature.html",restrict:"C",replace:!1,priority:0,link:function(s,d,c,u){s.changeState=function(t){s.pvi.state_code=e.IN_PREPARATION;for(var n in s.blockModel.block)s.blockModel.block[n]=!1;s.blockModel.block[t]=!0;var a=i.hash(t);o.$getByHandle("mainScroll").anchorScroll("#"+a)},s.addSignature=function(e){s.blockModel.block.signature_pad=!0,s.currentSignatureType=e,t(function(){s.signaturePad.clear()},100)},s.validateSignaturePvi=function(i){n.validateSignatures(s.pvi)&&(s.pvi.signature_datetime=_.getCurrentDate()+" "+_.getCurrentTime(!1),a.updatePvi(s.pvi,function(t){1==s.pvi.blank&&(s.pvi.id=t.id,s.pvi.blank=!1,s.pvi.state_code=e.TO_CLOSE,r.setLocalStorage(e.LS_KEY_PVI),l.navigate(e.INT_RT_PVI+s.pvi.id))}),t(function(){s.pvi.state_code=e.TO_CLOSE,s.pvi.actual_end_date=_.getCurrentDate(),s.pvi.actual_end_time=_.getCurrentTime(!0),r.setLocalStorage(e.LS_KEY_PVI)},500))}}}}]),domapp.directive("pviSignaturePad",["CONSTANTS","TEXT","alertService","$timeout","$location","$ionicScrollDelegate",function(e,t,i,n,a,r){return{templateUrl:e.BASE_PATH+"task/directives/pviSignaturePad.html",restrict:"E",replace:!0,priority:0,link:function(o,_,l,s){n(function(){function n(){c.style.width="100%",c.style.height="100%",c.width=window.innerWidth,c.height=window.innerWidth>window.innerHeight?210:480}var _=document.getElementById("signature-pad"),l=_.querySelector("[data-action=clear]"),s=_.querySelector("[data-action=cancel]"),d=_.querySelector("[data-action=save]"),c=_.querySelector("canvas");window.onresize=n,n(),o.signaturePad=new SignaturePad(c),l.addEventListener("click",function(e){o.signaturePad.clear()}),s.addEventListener("click",function(e){o.signaturePad.clear(),o.blockModel.block.signature_pad=!1,o.$apply()}),d.addEventListener("click",function(n){if(o.signaturePad.isEmpty())i.displayAlert(t.UA_NO_SIGNATURE_TITLE,t.UA_NO_SIGNATURE_TEXT,!1);else{switch(o.currentSignatureType){case e.SIGNATURE_CLIENT:o.pvi.client_signature_data=o.signaturePad.toDataURL();break;case e.SIGNATURE_TI:o.pvi.ti_signature_data=o.signaturePad.toDataURL()}o.signaturePad.clear(),o.blockModel.block.signature_pad=!1,o.$apply();var _=a.hash(o.currentSignatureType);r.$getByHandle("mainScroll").anchorScroll("#"+_)}})})}}}]),domapp.service("pviModel",[function(){this.pvi=[]}]),domapp.service("pviOtherModel",[function(){this.pvi=[]}]),domapp.factory("pviCommunicationService",["CONSTANTS","pviLocalService","communicationService","helperService","$timeout",function(e,t,i,n,a){return{updatePvi:function(t,r,o){var _=t.consignment_duration,l=t.work_day_trip_duration,s=t.work_day_work_duration_day,d=t.work_day_work_duration_evening_morning,c=t.work_day_work_duration_night,u=t.saturday_trip_duration,v=t.saturday_work_duration_day,p=t.saturday_work_duration_evening_morning,T=t.saturday_work_duration_night,f=t.sunday_offday_trip_duration,g=t.sunday_offday_work_duration_day,m=t.sunday_offday_work_duration_evening_morning,A=t.sunday_offday_work_duration_night,y=t.waiting_duration,S=t.preparation_duration;t.consignment_duration=n.convertToDecimal(t.consignment_duration),t.work_day_trip_duration=n.convertToDecimal(t.work_day_trip_duration),t.work_day_work_duration_day=n.convertToDecimal(t.work_day_work_duration_day),t.work_day_work_duration_evening_morning=n.convertToDecimal(t.work_day_work_duration_evening_morning),t.work_day_work_duration_night=n.convertToDecimal(t.work_day_work_duration_night),t.saturday_trip_duration=n.convertToDecimal(t.saturday_trip_duration),t.saturday_work_duration_day=n.convertToDecimal(t.saturday_work_duration_day),t.saturday_work_duration_evening_morning=n.convertToDecimal(t.saturday_work_duration_evening_morning),t.saturday_work_duration_night=n.convertToDecimal(t.saturday_work_duration_night),t.sunday_offday_trip_duration=n.convertToDecimal(t.sunday_offday_trip_duration),t.sunday_offday_work_duration_day=n.convertToDecimal(t.sunday_offday_work_duration_day),t.sunday_offday_work_duration_evening_morning=n.convertToDecimal(t.sunday_offday_work_duration_evening_morning),t.sunday_offday_work_duration_night=n.convertToDecimal(t.sunday_offday_work_duration_night),t.waiting_duration=n.convertToDecimal(t.waiting_duration),t.preparation_duration=n.convertToDecimal(t.preparation_duration),t.travel_log=[];for(var E=[e.WORK_DAY,e.SATURDAY,e.SUNDAY_OFFDAY],k=0,I=E.length;I>k;k++)switch(E[k]){case e.WORK_DAY:t.work_day&&("undefined"!=typeof t.work_day_mileage&&null!=t.work_day_mileage&&(t.work_day_mileage=Math.round(100*t.work_day_mileage)/100),t.travel_log.push({day_type:E[k],mileage:t.work_day_mileage,trip_duration:t.work_day_trip_duration,tolls:t.work_day_tolls,expenses:t.work_day_expenses,work_duration_day:t.work_day_work_duration_day,work_duration_evening_morning:t.work_day_work_duration_evening_morning,work_duration_night:t.work_day_work_duration_night}));break;case e.SATURDAY:t.saturday&&("undefined"!=typeof t.saturday_mileage&&null!=t.saturday_mileage&&(t.saturday_mileage=Math.round(100*t.saturday_mileage)/100),t.travel_log.push({day_type:E[k],mileage:t.saturday_mileage,trip_duration:t.saturday_trip_duration,tolls:t.saturday_tolls,expenses:t.saturday_expenses,work_duration_day:t.saturday_work_duration_day,work_duration_evening_morning:t.saturday_work_duration_evening_morning,work_duration_night:t.saturday_work_duration_night}));break;case e.SUNDAY_OFFDAY:t.sunday_offday&&("undefined"!=typeof t.sunday_offday_mileage&&null!=t.sunday_offday_mileage&&(t.sunday_offday_mileage=Math.round(100*t.sunday_offday_mileage)/100),t.travel_log.push({day_type:E[k],mileage:t.sunday_offday_mileage,trip_duration:t.sunday_offday_trip_duration,tolls:t.sunday_offday_tolls,expenses:t.sunday_offday_expenses,work_duration_day:t.sunday_offday_work_duration_day,work_duration_evening_morning:t.sunday_offday_work_duration_evening_morning,work_duration_night:t.sunday_offday_work_duration_night}))}var h=null,N=null;switch(t.blank){case!0:h="POST",N=e.API_URL_UPDATE_PVI;break;case!1:h="PUT",N=e.API_URL_UPDATE_PVI+"/"+t.id}i.request(t,N,h,function(e){"undefined"!=typeof r&&r(e)},function(e){"undefined"!=typeof o&&o(e)}),a(function(){t.consignment_duration=_,t.work_day_trip_duration=l,t.work_day_work_duration_day=s,t.work_day_work_duration_evening_morning=d,t.work_day_work_duration_night=c,t.saturday_trip_duration=u,t.saturday_work_duration_day=v,t.saturday_work_duration_evening_morning=p,t.saturday_work_duration_night=T,t.sunday_offday_trip_duration=f,t.sunday_offday_work_duration_day=g,t.sunday_offday_work_duration_evening_morning=m,t.sunday_offday_work_duration_night=A,t.waiting_duration=y,t.preparation_duration=S},500)},downloadPvi:function(n){i.request(null,e.API_URL_DOWNLOAD_PVI+"/"+n.id,"GET",function(e){t.setPvi(e,n)},function(e){})}}}]),domapp.factory("pviLocalService",["CONSTANTS","pviModel","pviOtherModel","persistenceService","helperService",function(e,t,i,n,a){return{setPvi:function(i,r){i.consignment_duration=a.convertToHoursMinutes(i.consignment_duration),i.work_day_trip_duration=a.convertToHoursMinutes(i.work_day_trip_duration),i.work_day_work_duration_day=a.convertToHoursMinutes(i.work_day_work_duration_day),i.work_day_work_duration_evening_morning=a.convertToHoursMinutes(i.work_day_work_duration_evening_morning),i.work_day_work_duration_night=a.convertToHoursMinutes(i.work_day_work_duration_night),i.saturday_trip_duration=a.convertToHoursMinutes(i.saturday_trip_duration),i.saturday_work_duration_day=a.convertToHoursMinutes(i.saturday_work_duration_day),i.saturday_work_duration_evening_morning=a.convertToHoursMinutes(i.saturday_work_duration_evening_morning),i.saturday_work_duration_night=a.convertToHoursMinutes(i.saturday_work_duration_night),i.sunday_offday_trip_duration=a.convertToHoursMinutes(i.sunday_offday_trip_duration),i.sunday_offday_work_duration_day=a.convertToHoursMinutes(i.sunday_offday_work_duration_day),i.sunday_offday_work_duration_evening_morning=a.convertToHoursMinutes(i.sunday_offday_work_duration_evening_morning),i.sunday_offday_work_duration_night=a.convertToHoursMinutes(i.sunday_offday_work_duration_night),i.waiting_duration=a.convertToHoursMinutes(i.waiting_duration),i.preparation_duration=a.convertToHoursMinutes(i.preparation_duration);for(var o=0,_=i.travel_log.length;_>o;o++)switch(i.travel_log[o].day_type){case e.WORK_DAY:i.work_day=!1,i.work_day_mileage=i.travel_log[o].mileage,i.work_day_trip_duration=i.travel_log[o].trip_duration,i.work_day_tolls=i.travel_log[o].tolls,i.work_day_expenses=i.travel_log[o].expenses,i.work_day_work_duration_day=i.travel_log[o].work_duration_day,i.work_day_work_duration_evening_morning=i.travel_log[o].work_duration_evening_morning,i.work_day_work_duration_night=i.travel_log[o].work_duration_night;break;case e.SATURDAY:i.saturday=!1,i.saturday_mileage=i.travel_log[o].mileage,i.saturday_trip_duration=i.travel_log[o].trip_duration,i.saturday_tolls=i.travel_log[o].tolls,i.saturday_expenses=i.travel_log[o].expenses,i.saturday_work_duration_day=i.travel_log[o].work_duration_day,i.saturday_work_duration_evening_morning=i.travel_log[o].work_duration_evening_morning,i.saturday_work_duration_night=i.travel_log[o].work_duration_night;break;case e.SUNDAY_OFFDAY:i.sunday_offday=!1,i.sunday_offday_mileage=i.travel_log[o].mileage,i.sunday_offday_trip_duration=i.travel_log[o].trip_duration,i.sunday_offday_tolls=i.travel_log[o].tolls,i.sunday_offday_expenses=i.travel_log[o].expenses,i.sunday_offday_work_duration_day=i.travel_log[o].work_duration_day,i.sunday_offday_work_duration_evening_morning=i.travel_log[o].work_duration_evening_morning,i.sunday_offday_work_duration_night=i.travel_log[o].work_duration_night}""!=i.waiting_duration&&null!=i.waiting_duration||(i.waiting_duration="0"),""!=i.preparation_duration&&null!=i.preparation_duration||(i.preparation_duration="0"),""!=i.observation_ti&&null!=i.observation_ti||(i.observation_ti="Rien à signaler"),""!==i.arrival_date&&null!==i.arrival_date||(i.arrival_date=i.mission_start_date),""!==i.arrival_time&&null!==i.arrival_time||(i.arrival_time=i.mission_start_time),""!==i.actual_start_date&&null!==i.actual_start_date||(i.actual_start_date=i.mission_start_date),""!==i.actual_start_time&&null!==i.actual_start_time||(i.actual_start_time=i.mission_start_time),i.pvi_type=e.TYPE_IN_PREPARATION,t.pvi.push(i),n.setLocalStorage(e.LS_KEY_PVI)},setOtherPvi:function(t){i.pvi.push(t),n.setLocalStorage(e.LS_KEY_PVI_OTHER)},removeOtherPviById:function(t){for(var a=i.pvi.length-1;a>=0;a--)i.pvi[a].id==t&&i.pvi.splice(a,1);n.setLocalStorage(e.LS_KEY_PVI_OTHER)},removeUserPviById:function(i){for(var a=t.pvi.length-1;a>=0;a--)t.pvi[a].id==i&&t.pvi.splice(a,1);n.setLocalStorage(e.LS_KEY_PVI)},checkPviExistsById:function(e){for(var i=t.pvi.length-1;i>=0;i--)if(t.pvi[i].id==e)return!0;return!1},checkPviOtherExistsById:function(e){for(var t=i.pvi.length-1;t>=0;t--)if(i.pvi[t].id==e)return!0;return!1},getPviById:function(e){for(var i=t.pvi.length-1;i>=0;i--)if(t.pvi[i].id==e)return t.pvi[i];return!1},createBlankPVI:function(){var i=Date.now(),n=a.getCurrentDate(),r=a.getCurrentTime(!0);return t.pvi.push({id:i,blank:!0,pvi_type:e.TYPE_CREATED,file_number:null,is_head_mission:!0,state_code:e.IN_PREPARATION,order_customer_name:null,final_customer_name:null,mission_start_date:n,mission_start_time:r,with_consignment:null,consignment_duration:null,arrival_date:n,arrival_time:r,is_intervention_nature_quotation:!1,is_intervention_nature_attachment:!1,is_intervention_nature_no_guarantee:!1,is_intervention_nature_with_guarantee:!1,is_intervention_nature_other:!1,intervention_nature_other_text:null,ti_number:0,actual_start_date:n,actual_start_time:r,actual_end_date:"",actual_end_time:"",waiting_duration:"0",preparation_duration:"0",waiting_duration_cause:null,materials:[],is_intervention_realised_maintenance:!1,is_intervention_realised_installation:!1,is_intervention_realised_replacement:!1,is_intervention_realised_assistance:!1,work_responsible_name:null,signature_datetime:null,client_signature_data:null,ti_signature_data:null,intervention_detail:null,device_measure:null,observation_ti:"Rien à signaler",observation_client:null,client_satisfaction_level:null,deadline:null,has_technical_report:null}),i}}}]),domapp.controller("pviOtherListController",["$scope","TEXT","pviListService","pviOtherModel","userModel",function(e,t,i,n,a){e.text=t,e.user=a.user,e.pvi=n.pvi,e.showDataLoader=!0,i.identifyPviOtherList(function(){e.showDataLoader=!1})}]),domapp.controller("pviUserListController",["$scope","CONSTANTS","TEXT","pviModel","pviListService","userModel",function(e,t,i,n,a,r){e.text=i,e.constants=t,e.user=r.user,e.pvi=n.pvi,e.showDataLoader=!0,a.identifyPviUserList(function(){e.showDataLoader=!1})}]),domapp.directive("pviOtherList",["CONSTANTS","routingService",function(e,t){return{restrict:"C",replace:!1,priority:0,link:function(i,n,a,r){i.loadUserList=function(i){t.navigate(e.INT_RT_PVI_USER_LIST)}}}}]),domapp.directive("pviOtherListItem",["CONSTANTS","pviCommunicationService","pviLocalService","persistenceService",function(e,t,i,n){return{templateUrl:e.BASE_PATH+"pviList/directives/pviOtherListItem.html",restrict:"C",replace:!1,priority:0,link:function(a,r,o,_){a.pviOtherTap=function(r){t.downloadPvi(a.pvi),i.removeOtherPviById(a.pvi.id),n.setLocalStorage(e.LS_KEY_PVI_OTHER)}}}}]),domapp.directive("pviUserList",["CONSTANTS","routingService","pviLocalService",function(e,t,i){return{restrict:"C",replace:!1,priority:0,link:function(n,a,r,o){n.loadOtherList=function(i){t.navigate(e.INT_RT_PVI_OTHER_LIST)},n.createBlankPVI=function(n){var a=i.createBlankPVI();t.navigate(e.INT_RT_PVI+a)}}}}]),domapp.directive("pviUserListItem",["CONSTANTS","routingService",function(e,t){return{templateUrl:e.BASE_PATH+"pviList/directives/taskListItem.html",restrict:"C",replace:!1,priority:0,link:function(i,n,a,r){i.pviUserTap=function(n){t.navigate(e.INT_RT_PVI+i.pvi.id)}}}}]),domapp.factory("pviListService",["CONSTANTS","communicationService","pviCommunicationService","pviLocalService",function(e,t,i,n){return{identifyPviUserList:function(a){t.request(null,e.API_URL_IDENTIFY_PVI_UL,"GET",function(e){for(var t=0,r=e.length;r>t;t++)n.checkPviExistsById(e[t].id)||i.downloadPvi(e[t]);"undefined"!=typeof a&&a()},function(e){})},identifyPviOtherList:function(i){t.request(null,e.API_URL_IDENTIFY_PVI_OL,"GET",function(e){for(var t=0,a=e.length;a>t;t++)n.checkPviOtherExistsById(e[t].id)||n.checkPviExistsById(e[t].id)||n.setOtherPvi(e[t]);"undefined"!=typeof i&&i()},function(e){})}}}]),domapp.service("userModel",["CONSTANTS",function(e){this.user={sesa:null,APIKey:null,activationState:e.NOT_ACTIVATED,activationCode:null}}]),domapp.factory("userLocalService",["CONSTANTS","userModel",function(e,t){return{getUser:function(){return t.user},activateUser:function(){t.user.activationState=e.ACTIVATED},setUserAPIKey:function(e){t.user.APIKey=e}}}]),domapp.factory("completionAnomaliesService",["validationModel",function(e){return{checkAnomaliesBlockCompletion:function(t,i){""!=i.waiting_duration&&null!=i.waiting_duration&&""!=i.preparation_duration&&null!=i.preparation_duration&&(0==parseInt(i.waiting_duration)||0!=i.waiting_duration&&""!=i.waiting_duration_cause&&null!=i.waiting_duration_cause)&&(e.validationAnomalies[t].complete=!0,e.validationAnomalies[t].error=!1,e.validationAnomalies.preparation_duration.error=!1,e.validationAnomalies.waiting_duration.error=!1,e.validationAnomalies.waiting_duration_cause.error=!1)}}}]),domapp.factory("completionAvantService",["validationModel",function(e){return{checkAvantBlockCompletion:function(t,i){""!=i.arrival_date&&null!=i.arrival_date&&""!=i.arrival_time&&null!=i.arrival_time&&(i.with_consignment===!0&&""!=i.consignment_duration&&null!=i.consignment_duration||i.with_consignment===!1)&&(e.validationAvant[t].complete=!0,e.validationAvant[t].error=!1,e.validationAvant.consignment_duration.error=!1,e.validationAvant.arrival_date.error=!1,e.validationAvant.arrival_time.error=!1)}}}]),domapp.factory("completionCloseService",["validationModel",function(e){return{checkCloseBlockCompletion:function(t,i){""!=i[t]&&null!=i[t]&&(e.validationClose[t].error=!1),""!=i.actual_end_date&&null!=i.actual_end_date&&""!=i.actual_end_time&&null!=i.actual_end_time&&(e.validationClose[t].complete=!0)}}}]),domapp.factory("completionDetailService",["validationModel",function(e){return{checkDetailBlockCompletion:function(t,i){""!=i[t]&&null!=i[t]&&(e.validationDetail[t].error=!1),(i.is_intervention_realised_maintenance||i.is_intervention_realised_installation||i.is_intervention_realised_replacement||i.is_intervention_realised_assistance)&&(e.validationDetail.interventions_realised.error=!1,i.is_intervention_realised_assistance&&null!=i.intervention_detail&&""!=i.intervention_detail&&null!=i.observation_ti&&""!=i.observation_ti&&(e.validationDetail[t].complete=!0,e.validationDetail[t].error=!1,e.validationDetail.observation_ti.error=!1,e.validationDetail.intervention_detail.error=!1),i.is_intervention_realised_assistance||null==i.observation_ti||""==i.observation_ti||(e.validationDetail[t].complete=!0,e.validationDetail[t].error=!1,e.validationDetail.observation_ti.error=!1))}}}]),domapp.factory("completionMainService",["validationModel",function(e){return{checkMainBlockCompletion:function(t,i){for(var n=["work_day","saturday","sunday_offday"],a=0,r=n.length;r>a;a++)i[n[a]]&&(""!=i[n[a]+"_work_duration_day"]&&null!=i[n[a]+"_work_duration_day"]||""!=i[n[a]+"_work_duration_evening_morning"]&&null!=i[n[a]+"_work_duration_evening_morning"]||""!=i[n[a]+"_work_duration_night"]&&null!=i[n[a]+"_work_duration_night"])&&(e.validationMain[t].complete=!0,e.validationMain[t].error=!1)}}}]),domapp.factory("completionMaterielService",["validationModel",function(e){return{checkMaterielBlockCompletion:function(t,i){var n=[];""!==i.has_technical_report&&null!==i.has_technical_report&&0==i.materials.length&&(e.validationMateriel[t].complete=!0,e.validationMateriel[t].error=!1);for(var a=0,r=i.materials.length;r>a;a++)""!==i.materials[a][t]&&null!==i.materials[a][t]&&"undefined"!=typeof e.validationMateriel[t]["line_"+i.materials[a].line]&&(e.validationMateriel[t]["line_"+i.materials[a].line].error=!1),""!=i.materials[a].elec_substation&&null!=i.materials[a].elec_substation&&""!=i.materials[a].elec_board&&null!=i.materials[a].elec_board&&""!=i.materials[a]["function"]&&null!=i.materials[a]["function"]&&""!=i.materials[a].material_info&&null!=i.materials[a].material_info?(n.push(!0),"undefined"!=typeof e.validationMateriel[t]["line_"+i.materials[a].line]&&(e.validationMateriel[t]["line_"+i.materials[a].line].error=!1)):(e.validationMateriel[t].complete=!1,n.push(!1));-1==n.indexOf(!1)&&""!==i.has_technical_report&&null!==i.has_technical_report&&(e.validationMateriel.materiel_block.complete=!0,e.validationMateriel.materiel_block.error=!1)}}}]),domapp.factory("completionService",["validationModel","completionTeteService","completionAvantService","completionMainService","completionAnomaliesService","completionMaterielService","completionDetailService","completionSignatureService","completionCloseService",function(validationModel,completionTeteService,completionAvantService,completionMainService,completionAnomaliesService,completionMaterielService,completionDetailService,completionSignatureService,completionCloseService){return{initializeCompletion:function(){for(var e=["Avant","Tete","Main","Anomalies","Materiel","Detail","Signature","Close"],t=0,i=e.length;i>t;t++)for(var n in validationModel["validation"+e[t]])"undefined"!=typeof validationModel["validation"+e[t]][n].complete&&(validationModel["validation"+e[t]][n].complete=!1)},checkBlockCompletion:function(pvi){for(var blockNameArray=["Avant","Tete","Main","Anomalies","Materiel","Detail","Signature","Close"],i=0,length=blockNameArray.length;length>i;i++)for(var key in validationModel["validation"+blockNameArray[i]])eval("completion"+blockNameArray[i]+"Service")["check"+blockNameArray[i]+"BlockCompletion"](key,pvi,blockNameArray[i])}}}]),domapp.factory("completionSignatureService",["validationModel","helperService",function(e,t){return{checkSignatureBlockCompletion:function(i,n){""!==n[i]&&null!==n[i]&&"undefined"!=typeof n[i]&&(e.validationSignature[i].error=!1),t.checkEmail(n.contact_email)&&(e.validationSignature.contact_email.error_format=!1),""!=n.work_responsible_name&&null!=n.work_responsible_name&&""!=n.client_signature_data&&null!=n.client_signature_data&&""!=n.ti_signature_data&&null!=n.ti_signature_data&&""!=n.client_satisfaction_level&&null!=n.client_satisfaction_level&&""!=n.contact_name&&null!=n.contact_name&&""!=n.contact_phone&&null!=n.contact_phone&&""!=n.contact_email&&null!=n.contact_email&&""!=n.contact_company_name&&null!=n.contact_company_name&&(e.validationSignature[i].complete=!0)}}}]),domapp.factory("completionTeteService",["validationModel",function(e){return{checkTeteBlockCompletion:function(t,i){""!==i[t]&&null!==i[t]&&(e.validationTete[t].error=!1,(i.is_intervention_nature_quotation||i.is_intervention_nature_attachment||i.is_intervention_nature_other)&&(e.validationTete.interventions_nature.error=!1)),""!==i.ti_number&&null!==i.ti_number&&""!==i.file_number&&null!==i.file_number&&""!==i.order_customer_name&&null!==i.order_customer_name&&""!==i.final_customer_name&&null!==i.final_customer_name&&""!==i.actual_start_date&&null!==i.actual_start_date&&""!==i.actual_start_time&&null!==i.actual_start_time&&(i.is_intervention_nature_quotation||i.is_intervention_nature_attachment||i.is_intervention_nature_other)&&(e.validationTete.interventions_nature.error=!1,i.is_intervention_nature_other?""!==i.interventions_nature_other_text&&null!==i.interventions_nature_other_text&&(e.validationTete[t].complete=!0,e.validationTete[t].error=!1,e.validationTete.interventions_nature_other_text.error=!1):(e.validationTete[t].complete=!0,e.validationTete[t].error=!1))}}}]),domapp.factory("validationAnomaliesService",["validationModel",function(e){return{validateAnomaliesBlock:function(t){var i=!0,n=function(n,a){""!==t[n]&&null!==t[n]||(e.validationAnomalies[n].error=!0,e.validationAnomalies[a].error=!0,i=!1)},a=function(n,a){var r=/([h])/;if(r.test(t[n])){var o=/^([0-9]{0,2}?)(h??)([0-9]{0,2}?)$/;o.test(t[n])&&1!=t[n].length||(e.validationAnomalies[n].error=!0,e.validationAnomalies[a].error=!0,i=!1)}else{var _=/^([0-9]{0,2}?)$/;_.test(t[n])||(e.validationAnomalies[n].error=!0,e.validationAnomalies[a].error=!0,i=!1)}};for(var r in e.validationAnomalies)switch(r){case"waiting_duration":case"preparation_duration":n(r,"anomalies_block"),a(r,"anomalies_block");break;case"waiting_duration_cause":0!==parseInt(t.waiting_duration)&&n(r,"anomalies_block")}return i}}}]),domapp.factory("validationAvantService",["validationModel",function(e){return{validateAvantBlock:function(t){var i=!0,n=function(n,a){""!==t[n]&&null!==t[n]||(e.validationAvant[n].error=!0,e.validationAvant[a].error=!0,i=!1)},a=function(n,a){var r=/([h])/;if(r.test(t[n])){var o=/^([0-9]{0,2}?)(h??)([0-9]{0,2}?)$/;o.test(t[n])&&1!=t[n].length||(e.validationAvant[n].error=!0,e.validationAvant[a].error=!0,i=!1)}else{var _=/^([0-9]{0,2}?)$/;_.test(t[n])||(e.validationAvant[n].error=!0,e.validationAvant[a].error=!0,i=!1)}};for(var r in e.validationAvant)switch(r){case"arrival_date":case"arrival_time":n(r,"avant_block");break;case"with_consignment":n(r,"avant_block"),t[r]&&(n("consignment_duration","avant_block"),a("consignment_duration","avant_block"))}return i}}}]),domapp.factory("validationCloseService",["validationModel",function(e){return{validateCloseBlock:function(t){var i=!0,n=function(n,a){""!==t[n]&&null!==t[n]||(e.validationClose[n].error=!0,e.validationClose[a].error=!0,i=!1)};for(var a in e.validationClose)switch(a){case"actual_end_date":case"actual_end_time":n(a,"close_block")}return i}}}]),domapp.factory("validationDetailService",["validationModel",function(e){return{validateDetailBlock:function(t){var i=!0,n=function(n,a){""!==t[n]&&null!==t[n]||(e.validationDetail[n].error=!0,e.validationDetail[a].error=!0,i=!1)},a=function(n,a){t[n]!==!1&&""!==t[n]&&null!==t[n]&&"undefined"!=typeof t[n]||(e.validationDetail[n].error=!0,e.validationDetail[a].error=!0,i=!1)};for(var r in e.validationDetail)switch(r){case"interventions_realised":case"is_intervention_realised_maintenance":case"is_intervention_realised_installation":case"is_intervention_realised_replacement":case"is_intervention_realised_assistance":t.is_intervention_realised_maintenance!==!0&&t.is_intervention_realised_installation!==!0&&t.is_intervention_realised_replacement!==!0&&t.is_intervention_realised_assistance!==!0&&a(r,"detail_block");break;case"intervention_detail":t.is_intervention_realised_assistance&&n(r,"detail_block");break;case"observation_ti":n(r,"detail_block")}return i}}}]),domapp.factory("validationMainService",["validationModel",function(e){return{validateMainBlock:function(t){var i=!0,n=function(e){return""===t[e]||null===t[e]?!0:void 0},a=function(e){var i=/([h])/;if(i.test(t[e])){var n=/^([0-9]{0,2}?)(h??)([0-9]{0,2}?)$/;if(!n.test(t[e])||1==t[e].length)return!0}else{var a=/^([0-9]{0,2}?)$/;if(!a.test(t[e]))return!0}};for(var r in e.validationMain)switch(r){case"work_day_work_duration_day":case"work_day_work_duration_evening_morning":case"work_day_work_duration_night":t.work_day&&(n("work_day_work_duration_day")||a("work_day_work_duration_day"))&&(n("work_day_work_duration_evening_morning")||a("work_day_work_duration_evening_morning"))&&(n("work_day_work_duration_night")||a("work_day_work_duration_night"))&&(e.validationMain[r].error=!0,e.validationMain.main_block.error=!0,i=!1);break;case"saturday_work_duration_day":case"saturday_work_duration_evening_morning":case"saturday_work_duration_night":t.saturday&&(n("saturday_work_duration_day")||a("saturday_work_duration_day"))&&(n("saturday_work_duration_evening_morning")||a("saturday_work_duration_evening_morning"))&&(n("saturday_work_duration_night")||a("saturday_work_duration_night"))&&(e.validationMain[r].error=!0,e.validationMain.main_block.error=!0,i=!1);break;case"sunday_offday_work_duration_day":case"sunday_offday_work_duration_evening_morning":case"sunday_offday_work_duration_night":t.sunday_offday&&(n("sunday_offday_work_duration_day")||a("sunday_offday_work_duration_day"))&&(n("sunday_offday_work_duration_evening_morning")||a("sunday_offday_work_duration_evening_morning"))&&(n("sunday_offday_work_duration_night")||a("sunday_offday_work_duration_night"))&&(e.validationMain[r].error=!0,e.validationMain.main_block.error=!0,i=!1)}return t.work_day||t.saturday||t.sunday_offday||(e.validationMain.day_selection.error=!0,e.validationMain.main_block.error=!0,i=!1),i}}}]),domapp.factory("validationMaterielService",["validationModel",function(e){return{validateMaterielBlock:function(t){var i=!0,n=function(n,a){""!==t[n]&&null!==t[n]||(e.validationMateriel[n].error=!0,e.validationMateriel[a].error=!0,i=!1)};for(var a in e.validationMateriel)switch(a){case"has_technical_report":n(a,"materiel_block");break;case"elec_substation":case"elec_board":case"function":case"material_info":for(var r=0,o=t.materials.length;o>r;r++)""!==t.materials[r][a]&&null!==t.materials[r][a]||("undefined"!=typeof e.validationMateriel[a]["line_"+t.materials[r].line]&&(e.validationMateriel[a]["line_"+t.materials[r].line].error=!0),e.validationMateriel.materiel_block.error=!0,i=!1)}return i}}}]),domapp.factory("validationService",["validationModel","validationCloseService","validationSignatureService","validationAvantService","validationTeteService","validationMainService","validationAnomaliesService","validationMaterielService","validationDetailService",function(e,t,i,n,a,r,o,_,l){return{initializeValidation:function(){for(var t=["Avant","Tete","Main","Anomalies","Materiel","Detail","Signature","Close"],i=["elec_board","elec_substation","function","material_info"],n=0,a=t.length;a>n;n++)for(var r in e["validation"+t[n]])if("undefined"!=typeof e["validation"+t[n]][r].error&&(e["validation"+t[n]][r].error=!1),-1!=i.indexOf(r))for(var o in e["validation"+t[n]][r])"undefined"!=typeof e["validation"+t[n]][r][o].error&&(e["validation"+t[n]][r][o].error=!1)},validateAvant:function(e){return n.validateAvantBlock(e)},validateTete:function(e){return a.validateTeteBlock(e)},validateMain:function(e){return r.validateMainBlock(e)},validateAnomalies:function(e){return o.validateAnomaliesBlock(e)},validateMateriel:function(e){return _.validateMaterielBlock(e)},validateDetail:function(e){return l.validateDetailBlock(e)},validateSignatures:function(e){return i.validateSignatureBlock(e)},validateClose:function(e){return t.validateCloseBlock(e)}}}]),domapp.factory("validationSignatureService",["validationModel","helperService",function(e,t){return{validateSignatureBlock:function(i){var n=!0,a=function(t,a){""!==i[t]&&null!==i[t]&&"undefined"!=typeof i[t]||(e.validationSignature[t].error=!0,e.validationSignature[a].error=!0,n=!1)},r=function(a,r){t.checkEmail(i[a])||(e.validationSignature[a].error_format=!0,e.validationSignature[r].error=!0,n=!1)};for(var o in e.validationSignature)switch(o){case"work_responsible_name":case"client_signature_data":case"ti_signature_data":case"client_satisfaction_level":case"contact_name":case"contact_phone":case"contact_company_name":a(o,"signature_block");break;case"contact_email":a(o,"signature_block"),r(o,"signature_block")}return n}}}]),domapp.factory("validationTeteService",["validationModel",function(e){return{validateTeteBlock:function(t){var i=!0,n=function(n,a){""!==t[n]&&null!==t[n]||(e.validationTete[n].error=!0,e.validationTete[a].error=!0,i=!1)},a=function(n,a){t[n]!==!1&&""!==t[n]&&null!==t[n]&&"undefined"!=typeof t[n]||(e.validationTete[n].error=!0,e.validationTete[a].error=!0,i=!1)};for(var r in e.validationTete)switch(r){case"interventions_nature":case"is_intervention_nature_quotation":case"is_intervention_nature_attachment":case"is_intervention_nature_other":t.is_intervention_nature_quotation!==!0&&t.is_intervention_nature_attachment!==!0&&t.is_intervention_nature_other!==!0&&a(r,"tete_block");break;case"interventions_nature_other_text":t.is_intervention_nature_other&&n(r,"tete_block");break;case"file_number":case"order_customer_name":case"final_customer_name":case"ti_number":case"actual_start_date":case"actual_start_time":n(r,"tete_block")}return i}}}]);